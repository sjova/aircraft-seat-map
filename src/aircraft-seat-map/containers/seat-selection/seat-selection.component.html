<div class="container" *ngIf="flights$ | async as flights; else progressBar">
  <div class="content">
    <div class="seat-selection-wrapper">
      <div *ngFor="let flightId of flights.allIds" class="group">
        <p class="flight">
          {{ flights.byId[flightId].flightInfo.departure.code }} -
          {{ flights.byId[flightId].flightInfo.arrival.code }}
        </p>

        <ng-container
          *ngFor="let passengerId of flights.byId[flightId].passengers.allIds"
        >
          <a
            class="passenger"
            title="Select Passenger"
            (click)="selectPassengerV2(flightId, passengerId)"
            [ngClass]="{
              active:
                userSelection.flightNumber ===
                  flights.byId[flightId].flightInfo.flightNumber &&
                userSelectionPassengerIdAsNumber ===
                  flights.byId[flightId].passengers.byId[passengerId].id,
              'condensed-item':
                flights.allIds.length *
                  flights.byId[flightId].passengers.allIds.length >
                10
            }"
          >
            {{ flights.byId[flightId].passengers.byId[passengerId].firstName }}
            {{ flights.byId[flightId].passengers.byId[passengerId].lastName }}:
            <ng-container
              *ngIf="
                flights.byId[flightId].passengers.byId[passengerId]
                  .seatRowNumber &&
                  flights.byId[flightId].passengers.byId[passengerId].seatCode;
                else notSelectedSeat
              "
            >
              {{
                flights.byId[flightId].passengers.byId[passengerId]
                  .seatRowNumber
              }}{{
                flights.byId[flightId].passengers.byId[passengerId].seatCode
              }}
            </ng-container>
            <ng-template #notSelectedSeat>
              <span matTooltip="Not selected seat">&nbsp;&nbsp;</span>
            </ng-template>
          </a>
        </ng-container>
      </div>
    </div>
    <div class="seat-map-wrapper">
      <app-seat-map
        [flightNumber]="userSelection.flightNumber"
        [passengerId]="userSelection.passengerId"
        [passengers]="flights.byId[userSelection.flightNumber]?.passengers"
        [seatMapState]="flights.byId[userSelection.flightNumber]?.seatMap"
        (seatSelection)="onSelection($event)"
      ></app-seat-map>
    </div>
  </div>

  <div class="footer">
    <div class="legend-outer-wrapper">
      <div class="legend-inner-wrapper">
        <div class="legend">
          <div class="info-box available"></div>
          <span class="label">Available</span>
        </div>
        <div class="legend">
          <div class="info-box unavailable"></div>
          <span class="label">Unavailable</span>
        </div>
        <div class="legend">
          <div class="info-box occupied"></div>
          <span class="label">Occupied</span>
        </div>
      </div>
    </div>
    <div class="cta-outer-wrapper">
      <div class="cta-inner-wrapper">
        <div>
          <p class="label-total-price">
            Total price:
            <ng-container *ngIf="flights.totalPrice; else defaultZero">
              {{ flights.totalPrice.total | number: "1.2-2" }}
              {{ flights.totalPrice.currencyCode }}
            </ng-container>
            <ng-template #defaultZero>0.00</ng-template>
          </p>
        </div>
        <div>
          <button
            class="cancel"
            mat-stroked-button
            title="Cancel Seats Selection"
            (click)="cancelSeatSelection()"
          >
            Cancel
          </button>
          <button
            class="confirm"
            mat-flat-button
            color="accent"
            routerLink="/demo/summary"
            title="Confirm Seats Selection"
            [queryParams]="queryParams"
            [disabled]="!isSeatSelectionValid"
          >
            Confirm Seating
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #progressBar>
  <div class="progress-bar-wrapper">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
</ng-template>
